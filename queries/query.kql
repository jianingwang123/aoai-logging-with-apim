 traces
| where message contains "Azure Open AI"
| order by timestamp desc
| extend responseBody = todynamic(tostring(message))
| extend 
    requestId = responseBody.requestId,
    subscriptionId = responseBody.subscriptionId,
    subscriptionName = responseBody.subscriptionName,
    operationId = responseBody.operationId,
    apiName = responseBody.apiName,
    apiRevision = responseBody.apiRevision,
    method = responseBody.method,
    headers = responseBody.headers,
    elapsed = responseBody.elapsed,
    serviceName = responseBody.serviceName,
    requestIp = responseBody.requestIp,
    url = responseBody.url,
    operationName = responseBody.operationName,
    region = responseBody.region,
    statusCode = responseBody.statusCode,
    statusReason = responseBody.statusReason,
    request = responseBody.request,
    response = responseBody.response,
    promptTokens = responseBody.response.usage.prompt_tokens,
    completionTokens = responseBody.response.usage.completion_tokens,
    totalTokens = responseBody.response.usage.total_tokens,
    model = responseBody.response.model,
    stream = responseBody.request.stream
|project  
    timestamp, 
    requestId,
    subscriptionId, 
    subscriptionName,
    operationId,
    apiName, 
    apiRevision,
    method,
    headers,
    elapsed,
    serviceName,
    requestIp,
    url,
    operationName,
    region,
    statusCode,
    statusReason,
    request,
    response,
    promptTokens,
    completionTokens,
    totalTokens,
    model,
    stream
